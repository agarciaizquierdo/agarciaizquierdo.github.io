---
layout: post
title: Qlik Sense - Usar variables en REST API
date: 2019-02-22 18:43
author: agarciaizquierdo
comments: true
tags: [BI, Qlik Sense, REST API]
---
No solo de <b>Splunk</b> vive el hombre! Otra de las herramientas con las que llevo bastante tiempo trabajando es <b>Qlik Sense</b>, una de las herramientas TOP dentro del mundo <b>BI. </b>Aunque la parte de visualización es muy potente, y a los usuarios finales les suele gustar mucho, para mi sin duda, su punto estrella es su posibilidad de ejercer de ETL, y la parte del script de carga, donde podemos programar recargas y hacer transformaciones de datos para luego presentárselas forma impecable al usuario.<br /><br />Pero bueno, vamos al grano, hace unos días me encontré con una problemática en un proyecto de <b>Qlik Sense</b>. Tenia que descargarme de varias web unos JSON para realizar unos dashboards, en principio la cosa no parecía muy complicada, salvo por la complejidad de como trata <b>Qlik</b> la descarga de los JSON, y la estructura que le da a estos, ademas estas descargas tenían que ser exactamente iguales, pero cambiando los credenciales, ya que en función del usuario, los datos eran diferentes, la verdad que en la cabeza lo veía claro, pero no encontré muchos ejemplos, y la documentación en este sentido era muy justa, decía que se podía hacer, pero no encontraba un ejemplo como el que yo buscaba, así que después de darle un par de vueltas, y orientándome por alguna cosillas que encontré en algún foro, di con la solución, que ahora os pongo aquí.<br /><br />De base parto de una tabla donde tengo mis usuarios, donde tengo usuarios y su token de acceso<br /><br /><span style="color:purple;">usuarios:</span><br /><span style="color:blue;">Load</span> * <span style="color:blue;">Inline</span> [<br />usuario, token<br />'pepe','123456'<br />'juan','qwerty'<br />];<br /><br /><br />Ahora necesito pasar estos token como argumentos en la conexiones a la REST API, y así no tener que hacer varias llamadas, una por usuario y token.<br />La clave en este caso es tener mi conexión correctamente configurada, y pasarle los argumentos con el comando <b>WITH CONNECTION</b><br /><br /><br /><span style="color:blue;">LIB CONNECT TO</span> '<span style="color:lime;">Servicio Rest</span>';<br /><br /><span style="color:blue;">for</span> <span style="color:magenta;">icredenciales</span>=0 <span style="color:blue;">to NoOfRows </span><span style="color:lime;">('usuarios')-1</span><br /><br />  <span style="color:blue;">let</span> <span style="color:magenta;">vRUL</span> = <span style="color:lime;">'https://www.ejemplo.com';</span><br />  <span style="color:blue;">let</span> <span style="color:magenta;">vcredencial</span> = <span style="color:blue;">peek</span>(<span style="color:lime;">'token'</span>,<span style="color:orange;">icredenciales</span>,<span style="color:lime;">'usuarios'</span>);<br /><br /><br /><br /><span style="color:purple;">RestConnectorMasterTable:</span><br />SQL SELECT                     
  XXXXXXXXXX  XXXXXXXXXX
  FROM JSON (wrap on) "root" PK "__KEY_root"<br />
  
  <b>WITH CONNECTION (</b><br /><b>url "$(vURL)",</b><br /><b>QUERY "authSchema" "anonymous",</b><br /><b>HTTPHEADER  "Authorization" "$(vcredencial)"</b><br /><b>);</b><br /><br /><span style="color:blue;">    drop table</span> <span style="color:purple;">RestConnectorMasterTable;</span><br /><br /><span style="color:blue;">next</span> <span style="color:magenta;">icredenciales</span><br /><span style="color:magenta;"><br /></span>Marco en negrita la parte del "WITH CONNECTION", donde puedo ir pasando variables, también podría añadir información en el BODY de la petición<br /><br />Aquí alguno ejemplo de los <a href="https://help.qlik.com/en-US/connectors/Subsystems/REST_connector_help/Content/Connectors_REST/Create-REST-connection/Pagination-scenarios.htm" target="_blank" rel="noopener noreferrer">doc oficial</a>.<br /><br />Espero que os sirva
